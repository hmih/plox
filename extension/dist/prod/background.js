"use strict";(()=>{var a={PROCESS:4,UPDATE:5,RETRY:6},u=(e,...t)=>{},p={"united states":"\u{1F1FA}\u{1F1F8}",usa:"\u{1F1FA}\u{1F1F8}",uk:"\u{1F1EC}\u{1F1E7}","united kingdom":"\u{1F1EC}\u{1F1E7}",canada:"\u{1F1E8}\u{1F1E6}",germany:"\u{1F1E9}\u{1F1EA}",france:"\u{1F1EB}\u{1F1F7}",australia:"\u{1F1E6}\u{1F1FA}",japan:"\u{1F1EF}\u{1F1F5}",brazil:"\u{1F1E7}\u{1F1F7}",india:"\u{1F1EE}\u{1F1F3}",china:"\u{1F1E8}\u{1F1F3}",europe:"\u{1F1EA}\u{1F1FA}",asia:"\u{1F30F}",africa:"\u{1F30D}",global:"\u{1F310}",austria:"\u{1F1E6}\u{1F1F9}"},m=127397,d=e=>{if(!e)return"\u{1F3F3}\uFE0F";let t=e.trim(),i=t.toLowerCase();for(let[n,r]of Object.entries(p))if(i.includes(n))return r;let o=t.match(/\b([A-Z]{2})\b/)?.[1];return o?String.fromCodePoint(o.charCodeAt(0)+m)+String.fromCodePoint(o.charCodeAt(1)+m):"\u{1F3F3}\uFE0F"};var E="https://plox.krepost.xy",f=new Map,c=new Set,R=async(e,t,i)=>{let o=f.get(e);if(o){chrome.tabs.sendMessage(t,{action:a.UPDATE,handle:e,elementId:i,flag:o.flag,location:o.location});return}if(!c.has(e)){c.add(e);try{let n=`${E}/met?username=${encodeURIComponent(e)}`,r=await fetch(n);if(!r.ok)throw new Error(`Server returned ${r.status}`);let s=await r.json();if(s.processed&&s.location){let g=d(s.location),l={location:s.location,flag:g};f.set(e,l),chrome.storage.local.set({[`cache:${e}`]:l}),chrome.tabs.sendMessage(t,{action:a.UPDATE,handle:e,elementId:i,flag:g,location:s.location})}}catch(n){u(`Lookup failed for ${e}:`,n),chrome.tabs.sendMessage(t,{action:a.RETRY,handle:e})}finally{c.delete(e)}}};typeof chrome<"u"&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener((e,t)=>{e.action===a.PROCESS&&t.tab?.id&&R(e.handle,t.tab.id,e.elementId)});})();
